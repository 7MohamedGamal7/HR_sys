{% extends 'hr_app/base.html' %}
{% load static %}

{% block title %}لوحة التحكم - نظام إدارة الموارد البشرية{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-3">
        <div class="card text-white bg-primary mb-3">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-users"></i> الموظفين</h5>
                <p class="card-text display-4">{{ total_employees }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success mb-3">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-calendar-check"></i> الحضور اليوم</h5>
                <p class="card-text display-4">{{ present_today }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-warning mb-3">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-umbrella-beach"></i> الإجازات اليوم</h5>
                <p class="card-text display-4">{{ leaves_today }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-info mb-3">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-file-invoice-dollar"></i> القروض المعلقة</h5>
                <p class="card-text display-4">{{ pending_loans }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-history"></i> الأنشطة الأخيرة</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>الموظف</th>
                                <th>الإجراء</th>
                                <th>التاريخ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in recent_logs %}
                            <tr>
                                <td>{{ log.emp_id }}</td>
                                <td>{{ log.action }}</td>
                                <td>{{ log.performed_at|date:"d/m/Y H:i" }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3">لا توجد أنشطة حديثة</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-calendar-alt"></i> الإجازات القادمة</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>الموظف</th>
                                <th>نوع الإجازة</th>
                                <th>تاريخ البدء</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for leave in upcoming_leaves %}
                            <tr>
                                <td>{{ leave.emp.emp_fullname }}</td>
                                <td>{{ leave.leave_type }}</td>
                                <td>{{ leave.start_date|date:"d/m/Y" }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3">لا توجد إجازات قادمة</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-clock"></i> التأخيرات الحديثة</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>الموظف</th>
                                <th>تاريخ التأخير</th>
                                <th>دقائق التأخير</th>
                                <th>السبب</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for late in recent_lates %}
                            <tr>
                                <td>{{ late.emp.emp_fullname }}</td>
                                <td>{{ late.late_date|date:"d/m/Y" }}</td>
                <td>{{ late.late_minutes }}</td>
                                <td>{{ late.reason }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4">لا توجد تأخيرات حديثة</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}