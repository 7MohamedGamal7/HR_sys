{% extends 'hr_app/base.html' %}
{% load static %}

{% block title %}التقارير - نظام إدارة الموارد البشرية{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5><i class="fas fa-chart-bar"></i> تقارير الموارد البشرية</h5>
            </div>
            <div class="card-body">
                <form method="GET" class="mb-4">
                    <div class="row">
                        <div class="col-md-3">
                            <select name="type" class="form-control">
                                <option value="attendance" {% if report_type == 'attendance' %}selected{% endif %}>تقرير الحضور</option>
                                <option value="leave" {% if report_type == 'leave' %}selected{% endif %}>تقرير الإجازات</option>
                                <option value="payroll" {% if report_type == 'payroll' %}selected{% endif %}>تقرير الرواتب</option>
                                <option value="employee" {% if report_type == 'employee' %}selected{% endif %}>تقرير الموظفين</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="date" name="start_date" class="form-control" value="{{ start_date }}" placeholder="تاريخ البدء">
                        </div>
                        <div class="col-md-3">
                            <input type="date" name="end_date" class="form-control" value="{{ end_date }}" placeholder="تاريخ الانتهاء">
                        </div>
                        <div class="col-md-3">
                            <input type="text" name="department" class="form-control" value="{{ department }}" placeholder="القسم">
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-md-12">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-filter"></i> تطبيق التصفية</button>
                            <a href="{% url 'reports' %}" class="btn btn-secondary"><i class="fas fa-redo"></i> إعادة تعيين</a>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive">
                    {% if report_type == 'attendance' %}
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>الموظف</th>
                                <th>القسم</th>
                                <th>إجمالي الأيام</th>
                                <th>الحضور</th>
                                <th>الغياب</th>
                                <th>التأخير</th>
                                <th>متوسط الساعات</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in report_data %}
                            <tr>
                                <td>{{ item.employee }}</td>
                                <td>{{ item.department }}</td>
                                <td>{{ item.total_days }}</td>
                                <td>{{ item.present }}</td>
                                <td>{{ item.absent }}</td>
                                <td>{{ item.late }}</td>
                                <td>{{ item.avg_hours }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7" class="text-center">لا توجد بيانات</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% elif report_type == 'leave' %}
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>الموظف</th>
                                <th>القسم</th>
                                <th>إجمالي الإجازات</th>
                                <th>موافق عليه</th>
                                <th>معلق</th>
                                <th>مرفوض</th>
                                <th>إجمالي الأيام</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in report_data %}
                            <tr>
                                <td>{{ item.employee }}</td>
                                <td>{{ item.department }}</td>
                                <td>{{ item.total_leaves }}</td>
                                <td>{{ item.approved }}</td>
                                <td>{{ item.pending }}</td>
                                <td>{{ item.rejected }}</td>
                                <td>{{ item.total_days }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7" class="text-center">لا توجد بيانات</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% elif report_type == 'payroll' %}
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>الموظف</th>
                                <th>القسم</th>
                                <th>الراتب الإجمالي</th>
                                <th>الخصومات</th>
                                <th>الراتب الصافي</th>
                                <th>إجمالي القروض</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in report_data %}
                            <tr>
                                <td>{{ item.employee }}</td>
                                <td>{{ item.department }}</td>
                                <td>{{ item.gross_pay }}</td>
                                <td>{{ item.deductions }}</td>
                                <td>{{ item.net_pay }}</td>
                                <td>{{ item.total_loans }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center">لا توجد بيانات</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>الموظف</th>
                                <th>المسمى الوظيفي</th>
                                <th>القسم</th>
                                <th>تاريخ التوظيف</th>
                                <th>الحالة</th>
                                <th>الراتب</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in report_data %}
                            <tr>
                                <td>{{ item.employee }}</td>
                                <td>{{ item.job_title }}</td>
                                <td>{{ item.department }}</td>
                                <td>{{ item.hire_date }}</td>
                                <td>
                                    {% if item.status %}
                                        <span class="badge bg-success">نشط</span>
                                    {% else %}
                                        <span class="badge bg-secondary">غير نشط</span>
                                    {% endif %}
                                </td>
                                <td>{{ item.salary }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center">لا توجد بيانات</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% endif %}
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-success"><i class="fas fa-file-excel"></i> تصدير إلى Excel</button>
                    <button class="btn btn-danger"><i class="fas fa-file-pdf"></i> تصدير إلى PDF</button>
                    <button class="btn btn-info"><i class="fas fa-print"></i> طباعة</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Sample chart for reports
    const ctx = document.getElementById('reportChart').getContext('2d');
    const reportChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Employee Count',
                data: [12, 19, 3, 5, 2, 3],
                backgroundColor: 'rgba(13, 110, 253, 0.5)',
                borderColor: 'rgba(13, 110, 253, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
});

function exportReport() {
    alert('Report exported successfully!');
}
</script>
{% endblock %}